{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the PetLife application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Pet": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pet",
      "type": "object",
      "description": "Represents a pet profile within the PetLife application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the pet."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Pet)"
        },
        "name": {
          "type": "string",
          "description": "Pet's name."
        },
        "species": {
          "type": "string",
          "description": "Species of the pet (e.g., dog, cat)."
        },
        "age": {
          "type": "number",
          "description": "Pet's age in years."
        },
        "breed": {
          "type": "string",
          "description": "Pet's breed."
        },
        "weight": {
          "type": "number",
          "description": "Pet's current weight in kilograms."
        },
        "weightGoal": {
          "type": "string",
          "description": "Pet's weight goal (e.g., lose weight, maintain weight, gain weight)."
        },
        "allergies": {
          "type": "string",
          "description": "A list of the pet's known allergies."
        },
        "isPro": {
          "type": "boolean",
          "description": "Indicates if the user has a Pro subscription for this pet."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "species",
        "age",
        "breed",
        "weight",
        "weightGoal",
        "isPro"
      ]
    },
    "MealPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MealPlan",
      "type": "object",
      "description": "Represents a meal plan for a pet.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the meal plan."
        },
        "petId": {
          "type": "string",
          "description": "Reference to Pet. (Relationship: Pet 1:N MealPlan)"
        },
        "date": {
          "type": "string",
          "description": "Date for which the meal plan is applicable.",
          "format": "date-time"
        },
        "mealDetails": {
          "type": "string",
          "description": "A json string containing details of the meal plan."
        }
      },
      "required": [
        "id",
        "petId",
        "date",
        "mealDetails"
      ]
    },
    "SupplementRecommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SupplementRecommendation",
      "type": "object",
      "description": "Represents a supplement recommendation for a pet.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the supplement recommendation."
        },
        "petId": {
          "type": "string",
          "description": "Reference to Pet. (Relationship: Pet 1:N SupplementRecommendation)"
        },
        "supplementName": {
          "type": "string",
          "description": "Name of the recommended supplement."
        },
        "dosage": {
          "type": "string",
          "description": "Recommended dosage of the supplement."
        },
        "reason": {
          "type": "string",
          "description": "Reason for recommending the supplement."
        }
      },
      "required": [
        "id",
        "petId",
        "supplementName",
        "dosage",
        "reason"
      ]
    },
    "ActivityRecord": {
      "$schema": "http://json-schema.org/draft-07-schema#",
      "title": "ActivityRecord",
      "type": "object",
      "description": "Represents an activity record for a pet.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the activity record."
        },
        "petId": {
          "type": "string",
          "description": "Reference to Pet. (Relationship: Pet 1:N ActivityRecord)"
        },
        "date": {
          "type": "string",
          "description": "Date of the activity record.",
          "format": "date-time"
        },
        "activityType": {
          "type": "string",
          "description": "Type of activity (e.g., walk, run, play)."
        },
        "duration": {
          "type": "number",
          "description": "Duration of the activity in minutes."
        }
      },
      "required": [
        "id",
        "petId",
        "date",
        "activityType",
        "duration"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/pets/{petId}",
        "definition": {
          "entityName": "Pet",
          "schema": {
            "$ref": "#/backend/entities/Pet"
          },
          "description": "Stores pet profiles owned by a specific user. Uses path-based ownership for private pet data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "petId",
              "description": "The unique identifier for the pet."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/pets/{petId}/mealPlans/{mealPlanId}",
        "definition": {
          "entityName": "MealPlan",
          "schema": {
            "$ref": "#/backend/entities/MealPlan"
          },
          "description": "Stores meal plans for a specific pet. Uses path-based ownership for meal plan data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "petId",
              "description": "The unique identifier for the pet."
            },
            {
              "name": "mealPlanId",
              "description": "The unique identifier for the meal plan."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/pets/{petId}/supplementRecommendations/{supplementRecommendationId}",
        "definition": {
          "entityName": "SupplementRecommendation",
          "schema": {
            "$ref": "#/backend/entities/SupplementRecommendation"
          },
          "description": "Stores supplement recommendations for a specific pet. Uses path-based ownership for supplement recommendation data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "petId",
              "description": "The unique identifier for the pet."
            },
            {
              "name": "supplementRecommendationId",
              "description": "The unique identifier for the supplement recommendation."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/pets/{petId}/activityRecords/{activityRecordId}",
        "definition": {
          "entityName": "ActivityRecord",
          "schema": {
            "$ref": "#/backend/entities/ActivityRecord"
          },
          "description": "Stores activity records for a specific pet. Uses path-based ownership for activity record data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "petId",
              "description": "The unique identifier for the pet."
            },
            {
              "name": "activityRecordId",
              "description": "The unique identifier for the activity record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the PetLife application. User and Pet data are stored in hierarchical paths to establish clear ownership. Meal Plans, Supplement Recommendations, and Activity Records are stored as subcollections under each Pet document to facilitate easy querying and management of data specific to each pet. This structure avoids the need for `get()` calls in security rules, enabling atomic operations. Segregation into subcollections allows for homogeneous security postures for each entity. This design also supports the required QAPs by using clear path-based ownership and dedicated subcollections, making list operations secure."
  }
}
